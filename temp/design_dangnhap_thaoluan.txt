Vá»›i há»‡ thá»‘ng hiá»‡n táº¡i dá»±a trÃªn PocketBase, chá»©c nÄƒng Ä‘Äƒng kÃ½ / Ä‘Äƒng nháº­p ngÆ°á»i dÃ¹ng Ä‘Æ°á»£c triá»ƒn khai ngay trÃªn PocketBase â€” báº¡n khÃ´ng cáº§n tá»± code logic xÃ¡c thá»±c tá»« Ä‘áº§u.

PocketBase Ä‘Ã£ tÃ­ch há»£p sáºµn:

XÃ¡c thá»±c ngÆ°á»i dÃ¹ng qua email/máº­t kháº©u
JWT token cho xÃ¡c thá»±c API
Collection users máº·c Ä‘á»‹nh, nhÆ°ng báº¡n cÃ³ thá»ƒ má»Ÿ rá»™ng báº±ng collection tÃ¹y chá»‰nh (á»Ÿ Ä‘Ã¢y lÃ  musers)
âœ… CÃ¡ch triá»ƒn khai Ä‘Äƒng kÃ½ / Ä‘Äƒng nháº­p theo thiáº¿t káº¿ cá»§a báº¡n
1. Cáº¥u hÃ¬nh collection musers trong PocketBase
Táº¡o collection musers vá»›i cÃ¡c trÆ°á»ng:
email (unique, required)
password (required, kiá»ƒu password)
fcm_token (text, optional)
is_fcm_active (bool, default = false)
ğŸ’¡ PocketBase tá»± xá»­ lÃ½ mÃ£ hÃ³a máº­t kháº©u vÃ  xÃ¡c thá»±c JWT khi báº¡n dÃ¹ng endpoint built-in. 

2. ÄÄƒng kÃ½ (Sign Up)
Gá»­i request tá»›i endpoint máº·c Ä‘á»‹nh cá»§a PocketBase:

http


1
2
3
4
5
6
7
8
POST /api/collections/musers/records
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "secure123",
  "passwordConfirm": "secure123"
}
ğŸ”’ PocketBase tá»± validate vÃ  lÆ°u user (máº­t kháº©u Ä‘Æ°á»£c bÄƒm tá»± Ä‘á»™ng). 

3. ÄÄƒng nháº­p (Login)
Gá»­i request:

http


1
2
3
4
5
6
7
POST /api/collections/musers/auth-with-password
Content-Type: application/json

{
  "identity": "user@example.com",
  "password": "secure123"
}
â†’ Response sáº½ bao gá»“m:

token (JWT)
record (thÃ´ng tin user, bao gá»“m id, email, fcm_token, v.v.)
Client lÆ°u token nÃ y Ä‘á»ƒ dÃ¹ng cho cÃ¡c request sau. 

4. Cáº­p nháº­t FCM token khi Ä‘Äƒng nháº­p
Sau khi Ä‘Äƒng nháº­p thÃ nh cÃ´ng, client gá»­i thÃªm má»™t request PATCH Ä‘á»ƒ cáº­p nháº­t fcm_token:

http


1
2
3
4
5
6
7
8
PATCH /api/collections/musers/records/{user_id}
Authorization: Bearer <token>
Content-Type: application/json

{
  "fcm_token": "new_fcm_token_123",
  "is_fcm_active": true
}
â†’ Äiá»u nÃ y Ä‘áº£m báº£o: má»—i user chá»‰ cÃ³ 1 FCM token, vÃ  token má»›i ghi Ä‘Ã¨ token cÅ© â€” Ä‘Ãºng theo yÃªu cáº§u cá»§a báº¡n.

ğŸ” Báº£o vá»‡ cÃ¡c API khÃ¡c
Vá»›i má»i request cáº§n xÃ¡c thá»±c (vd: táº¡o reminder), client gá»­i kÃ¨m:


1
Authorization: Bearer <token>
PocketBase tá»± Ä‘á»™ng xÃ¡c thá»±c JWT vÃ  gáº¯n authRecord vÃ o context â€” backend Go cá»§a báº¡n cÃ³ thá»ƒ truy xuáº¥t user_id tá»« Ä‘Ã³.
ğŸ“Œ LÆ°u Ã½ quan trá»ng
KhÃ´ng cáº§n tá»± xÃ¢y dá»±ng /login, /signup trong Go â€” dÃ¹ng trá»±c tiáº¿p API cá»§a PocketBase.
Náº¿u cáº§n custom logic (vd: validate thÃªm), báº¡n cÃ³ thá»ƒ dÃ¹ng PocketBase hooks (trong pb_hooks/) hoáº·c gá»i PocketBase API tá»« phÃ­a Go worker/server.
Collection musers pháº£i báº­t auth (auth = true trong cáº¥u hÃ¬nh collection).
âœ… Tá»•ng káº¿t
ÄÄƒng kÃ½
POST /api/collections/musers/records
ÄÄƒng nháº­p
POST /api/collections/musers/auth-with-password
Cáº­p nháº­t FCM
PATCH /api/collections/musers/records/{id}
sau login
XÃ¡c thá»±c API
Gá»­i
Authorization: Bearer <token>

Báº¡n chá»‰ cáº§n Ä‘áº£m báº£o client gá»i Ä‘Ãºng cÃ¡c endpoint cá»§a PocketBase, pháº§n cÃ²n láº¡i do PocketBase vÃ  thiáº¿t káº¿ musers cá»§a báº¡n xá»­ lÃ½.

Cáº§n mÃ¬nh há»— trá»£ viáº¿t client-side (Flutter/React/Go mobile) hoáº·c script kiá»ƒm tra Ä‘Äƒng kÃ½/login khÃ´ng?







cÃ³ ngÆ°á»i hÆ°á»›ng dáº«n tÃ´i, báº¡n xem cÃ³ khÃ¡c cá»§a báº¡n khÃ´ng:
BÆ°á»›c 1: Setup PocketBase Collection
Collection: musers
â”œâ”€ email (text, unique, required) â­
â”œâ”€ password (password, required) â­
â”œâ”€ name (text, required)
â”œâ”€ fcm_token (text, optional)
â”œâ”€ is_fcm_active (bool, default=false)
â”œâ”€ emailVisibility (bool, default=false)
â”œâ”€ verified (bool, default=false)
â””â”€ (Auto: created, updated)
BÆ°á»›c 2: Client Implementation
javascript// Register
POST /api/collections/musers/records
{
  "email": "user@example.com",
  "password": "secure123",
  "passwordConfirm": "secure123",
  "name": "John Doe"
}
// Response: { record: {...}, ... }

// Login
POST /api/collections/musers/auth-with-password
{
  "identity": "user@example.com",
  "password": "secure123"
}
// Response: { token: "...", record: {...} }

// Save token + Update FCM
token = response.token
userId = response.record.id

PATCH /api/collections/musers/records/{userId}
Authorization: Bearer {token}
{
  "fcm_token": "device-fcm-token",
  "is_fcm_active": true
}
BÆ°á»›c 3: Backend - Protect Routes
go// Middleware: verify PocketBase token
func AuthMiddleware(app core.App) echo.MiddlewareFunc {
    return func(next echo.HandlerFunc) echo.HandlerFunc {
        return func(c echo.Context) error {
            // PocketBase tá»± verify token
            authRecord, err := c.Get("authRecord").(*models.Record)
            if err != nil || authRecord == nil {
                return c.JSON(401, map[string]string{"error": "unauthorized"})
            }
            
            c.Set("user_id", authRecord.Id)
            return next(c)
        }
    }
}

// DÃ¹ng middleware cho protected routes
secure := api.Group("/secure")
secure.Use(AuthMiddleware(app))
secure.POST("/reminders", reminderHandler.CreateReminder)
// ...
BÆ°á»›c 4: PocketBase Rules (Collection Rules)
musers collection rules:
â”œâ”€ Create: anyone can register
â”œâ”€ Read: self can read own record
â”œâ”€ Update: self can update own FCM token
â””â”€ Delete: self can delete own account

profile
Qwen3-Max
HÆ°á»›ng dáº«n báº¡n vá»«a chia sáº» ráº¥t khá»›p vá»›i thiáº¿t káº¿ trong tÃ i liá»‡u SRS.md vÃ  project_overview.md â€” khÃ´ng cÃ³ mÃ¢u thuáº«n, mÃ  bá»• sung ráº¥t rÃµ rÃ ng cho pháº§n Ä‘Äƒng kÃ½/Ä‘Äƒng nháº­p dá»±a trÃªn PocketBase. DÆ°á»›i Ä‘Ã¢y lÃ  Ä‘Ã¡nh giÃ¡ chi tiáº¿t tÃ­nh Ä‘á»“ng nháº¥t vÃ  Ä‘iá»ƒm báº¡n cáº§n lÆ°u Ã½ triá»ƒn khai:

âœ… Äiá»ƒm hoÃ n toÃ n khá»›p vá»›i SRS & kiáº¿n trÃºc hiá»‡n táº¡i
Collection musers vá»›i fcm_token vÃ  is_fcm_active
âœ… CÃ³
SRS má»¥c 3.1,
project_overview.md
khÃ´ng Ä‘á»‹nh nghÄ©a chi tiáº¿t schema nhÆ°ng logic xá»­ lÃ½ FCM khá»›p
1 user â†’ 1 FCM token (ghi Ä‘Ã¨ khi Ä‘Äƒng nháº­p)
âœ… CÃ³
SRS má»¥c 1 & 5.1
Client gá»i /auth-with-password rá»“i PATCH FCM
âœ… CÃ³
ÄÃºng luá»“ng xá»­ lÃ½ trong SRS + báº¡n lÃ m Ä‘Ãºng cÃ¡ch khuyáº¿n nghá»‹ cá»§a PocketBase
Backend dÃ¹ng middleware xÃ¡c thá»±c JWT tá»« PocketBase
âœ… Ráº¥t khá»›p
project_overview.md
cÃ³
middleware/
, vÃ  PocketBase tá»± inject
authRecord
â€” báº¡n khÃ´ng cáº§n tá»± verify JWT
Collection rules: chá»‰ cho phÃ©p user thao tÃ¡c trÃªn chÃ­nh mÃ¬nh
âœ… Tá»‘t
ÄÃ¢y lÃ  best practice, vÃ  phÃ¹ há»£p vá»›i thiáº¿t káº¿ â€œkhÃ´ng tá»± code authâ€ cá»§a báº¡n
ğŸ” Äiá»ƒm nhá» cáº§n xÃ¡c nháº­n / lÆ°u Ã½ khi triá»ƒn khai
name field trong musers
SRS báº£n hiá»‡n táº¡i khÃ´ng Ä‘á» cáº­p Ä‘áº¿n name, nhÆ°ng khÃ´ng cáº¥m.
â†’ OK, báº¡n cÃ³ thá»ƒ thÃªm name Ä‘á»ƒ phá»¥c vá»¥ client (hiá»ƒn thá»‹ UI), nhÆ°ng worker khÃ´ng cáº§n dÃ¹ng.
emailVisibility, verified
LÃ  cÃ¡c field tá»± Ä‘á»™ng cÃ³ sáºµn trong collection auth cá»§a PocketBase.
â†’ Cá»© Ä‘á»ƒ nguyÃªn, PocketBase dÃ¹ng Ä‘á»ƒ quáº£n lÃ½ xÃ¡c thá»±c email (náº¿u báº­t email verification).
Middleware xÃ¡c thá»±c
Trong vÃ­ dá»¥ JavaScript báº¡n lÆ°u token, trong Go middleware báº¡n láº¥y authRecord tá»« context.
â†’ âœ… ÄÃºng. PocketBase middleware (náº¿u báº¡n dÃ¹ng pocketbase-sdk-go hoáº·c nhÃºng PocketBase core) tá»± inject authRecord khi request cÃ³ header Authorization: Bearer <token> há»£p lá»‡.
Cáº­p nháº­t FCM token: dÃ¹ng PATCH sau login
âœ… ÄÃ¢y lÃ  cÃ¡ch Ä‘Ãºng Ä‘á»ƒ Ä‘áº£m báº£o:
Token má»›i ghi Ä‘Ã¨ token cÅ©
KhÃ´ng cho phÃ©p ngÆ°á»i khÃ¡c cáº­p nháº­t FCM cá»§a user khÃ¡c (nhá» collection rule Update: @request.auth.id = @id)
ğŸ›  Gá»£i Ã½ rule cho PocketBase collection musers
Äá»ƒ Ä‘áº£m báº£o an toÃ n, báº¡n nÃªn Ä‘áº·t Collection Rules nhÆ° sau trong PocketBase Admin UI:

js


1
2
3
4
5
6
7
8
9
10
11
// Create
true  // ai cÅ©ng Ä‘Äƒng kÃ½ Ä‘Æ°á»£c

// Read
@request.auth.id = @id  // chá»‰ Ä‘á»c Ä‘Æ°á»£c cá»§a chÃ­nh mÃ¬nh

// Update
@request.auth.id = @id  // chá»‰ update Ä‘Æ°á»£c record cá»§a mÃ¬nh

// Delete
@request.auth.id = @id
VÃ  Field-level rules (náº¿u cáº§n kiá»ƒm soÃ¡t cháº·t hÆ¡n):

fcm_token, is_fcm_active: editable bá»Ÿi @request.auth.id = @id
email, password: khÃ´ng cho phÃ©p Ä‘á»•i sau khi táº¡o (tuá»³ Ã½)
